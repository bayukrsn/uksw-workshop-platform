<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workshop Platform - Dokumentasi Sistem</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        :root {
            --primary: #b45309;
            --primary-light: #d97706;
            --secondary: #334155;
            --accent: #ea580c;
            --success: #15803d;
            --background: #ffffff;
            --surface: #f8fafc;
            --border: #cbd5e1;
            --text-main: #0f172a;
            --text-muted: #475569;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            color: var(--text-main);
            line-height: 1.7;
            background: var(--background);
            font-size: 16px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 50px;
        }

        header {
            border-bottom: 4px solid var(--primary);
            padding-bottom: 30px;
            margin-bottom: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            color: var(--text-main);
            margin-bottom: 10px;
            font-weight: 800;
        }

        header .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        header .meta {
            margin-top: 15px;
            display: inline-block;
            background: var(--surface);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--secondary);
            border: 1px solid var(--border);
        }

        .toc {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 50px;
            page-break-after: always;
        }

        .toc h2 {
            font-size: 1.25rem;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: none;
        }

        .toc ol {
            columns: 2;
            column-gap: 40px;
            margin-left: 20px;
        }

        .toc li {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .toc a {
            text-decoration: none;
            color: var(--text-main);
        }

        section {
            margin-bottom: 60px;
            page-break-inside: avoid;
        }

        h2 {
            font-size: 1.75rem;
            color: var(--text-main);
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-weight: 700;
        }

        h3 {
            font-size: 1.35rem;
            color: var(--secondary);
            margin: 30px 0 15px 0;
            font-weight: 600;
        }

        h4 {
            font-size: 1.1rem;
            color: var(--primary);
            margin: 20px 0 10px 0;
            font-weight: 600;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            page-break-inside: avoid;
        }

        .card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .card p {
            margin: 0;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .diagram-section {
            background: #fefefe;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            page-break-inside: avoid;
        }

        .diagram-section h4 {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .diagram-explanation {
            background: #f0f9ff;
            border-left: 4px solid #0284c7;
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }

        .diagram-explanation strong {
            color: #0369a1;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }

        pre {
            background: #1e293b;
            color: #f8fafc;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            margin: 15px 0;
            page-break-inside: avoid;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: #f1f5f9;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #be123c;
        }

        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95rem;
        }

        th,
        td {
            padding: 12px 15px;
            border: 1px solid var(--border);
            text-align: left;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8fafc;
        }

        ul,
        ol {
            margin: 10px 0 15px 25px;
        }

        li {
            margin-bottom: 5px;
        }

        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .page-break {
            page-break-before: always;
        }

        @media print {
            body {
                background: white;
                font-size: 11pt;
            }

            .container {
                padding: 0;
                width: 100%;
                max-width: none;
            }

            a {
                color: black;
                text-decoration: none;
            }

            .toc {
                break-after: page;
            }

            section {
                break-inside: avoid;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üõ†Ô∏è Workshop Platform</h1>
            <p class="subtitle">Sistem Pendaftaran Workshop Interaktif & High-Concurrency</p>
            <div class="meta">Versi 2.2 ‚Ä¢ Universitas Kristen Satya Wacana ‚Ä¢ Februari 2026</div>
        </header>

        <nav class="toc">
            <h2>üìë Daftar Isi</h2>
            <ol>
                <li><a href="#overview">Gambaran Sistem</a></li>
                <li><a href="#use-case">Use Case Diagram</a></li>
                <li><a href="#class-diagram">Class Diagram</a></li>
                <li><a href="#erd">Entity Relationship Diagram</a></li>
                <li><a href="#component">Component Diagram</a></li>
                <li><a href="#sequence">Sequence Diagram</a></li>
                <li><a href="#state">State Diagram</a></li>
                <li><a href="#activity">Activity Diagram</a></li>
                <li><a href="#dfd">Data Flow Diagram</a></li>
                <li><a href="#flowchart">System Flowchart</a></li>
                <li><a href="#api">Referensi API</a></li>
            </ol>
        </nav>

        <!-- SECTION 1: Overview -->
        <section id="overview">
            <h2>1. Gambaran Sistem</h2>
            <p>
                <strong>Workshop Platform</strong> adalah sistem pendaftaran workshop berperforma tinggi yang dirancang
                untuk menangani lonjakan trafik pendaftaran ("War Workshop").
                Sistem menggunakan arsitektur <strong>Event-Driven</strong> dengan Apache Kafka untuk menjamin urutan
                antrian yang adil (FIFO) dan WebSocket untuk pengalaman real-time.
            </p>
            <div class="grid">
                <div class="card">
                    <h4>üöÄ High Concurrency</h4>
                    <p>Mampu menangani ratusan request per detik dengan mekanisme antrian Kafka yang scalable.</p>
                </div>
                <div class="card">
                    <h4>üì° Real-time Updates</h4>
                    <p>Notifikasi instan untuk status antrian dan ketersediaan kursi tanpa refresh halaman.</p>
                </div>
                <div class="card">
                    <h4>üîí Data Consistency</h4>
                    <p>Distributed Locking dengan Redis menjamin tidak ada "double booking" pada pemilihan kursi.</p>
                </div>
                <div class="card">
                    <h4>üìä Interactive UI</h4>
                    <p>Seat map visual yang intuitif untuk memilih tempat duduk yang diinginkan.</p>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Use Case Diagram -->
        <section id="use-case" class="page-break">
            <h2>2. Use Case Diagram</h2>

            <div class="diagram-section">
                <h4>üìã Diagram Use Case Sistem</h4>
                <div class="mermaid">
                    flowchart LR
                    subgraph Actors["üë• Aktor"]
                    S["üéì Mahasiswa"]
                    M["üë®‚Äçüè´ Mentor"]
                    T["‚è∞ System Timer"]
                    end

                    subgraph System["üè¢ Workshop Platform"]
                    UC1["üîê Login/Register"]
                    UC2["üìù Join Queue"]
                    UC3["üí∫ Select Seat"]
                    UC4["‚úÖ Enroll Workshop"]
                    UC5["üìö Manage Workshops"]
                    UC6["üëÄ Monitor Queue"]
                    UC7["‚úîÔ∏è Approve Users"]
                    UC8["üóëÔ∏è Cleanup Expired"]
                    end

                    S --> UC1
                    S --> UC2
                    S --> UC3
                    S --> UC4

                    M --> UC1
                    M --> UC5
                    M --> UC6
                    M --> UC7

                    T --> UC8

                    style S fill:#dbeafe,stroke:#2563eb,stroke-width:2px
                    style M fill:#dcfce7,stroke:#16a34a,stroke-width:2px
                    style T fill:#fef3c7,stroke:#d97706,stroke-width:2px
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Use Case Diagram menunjukkan interaksi antara aktor dengan sistem.
                    <ul>
                        <li><strong>Mahasiswa:</strong> Dapat login, bergabung ke antrian, memilih kursi, dan mendaftar
                            workshop.</li>
                        <li><strong>Mentor:</strong> Dapat mengelola workshop, memonitor antrian, dan menyetujui
                            pendaftaran user baru.</li>
                        <li><strong>System Timer:</strong> Aktor otomatis yang membersihkan reservasi kursi yang sudah
                            expired.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Class Diagram -->
        <section id="class-diagram">
            <h2>3. Class Diagram</h2>

            <div class="diagram-section">
                <h4>üèóÔ∏è Struktur Class Utama</h4>
                <div class="mermaid">
classDiagram
    direction TB
    class User {
        +id
        +nimNidn
        +name
        +email
        +role
        +login()
        +logout()
    }
    class Student {
        +major
        +semester
        +maxCredits
        +joinQueue()
        +enrollWorkshop()
    }
    class Mentor {
        +department
        +maxStudents
        +createWorkshop()
        +approveUser()
    }
    class Workshop {
        +id
        +code
        +name
        +credits
        +workshopType
    }
    class Session {
        +id
        +quota
        +seatsEnabled
        +getAvailableSeats()
    }
    class Seat {
        +id
        +seatNumber
        +status
        +lock()
        +reserve()
        +confirm()
    }
    class Enrollment {
        +id
        +enrolledAt
        +status
    }

    User <|-- Student
    User <|-- Mentor
    Workshop *-- Session
    Session *-- Seat
    Student --> Enrollment
    Enrollment --> Session
    Enrollment --> Seat
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Class Diagram menunjukkan struktur objek dalam sistem.
                    <ul>
                        <li><strong>User:</strong> Class dasar dengan inheritance ke Student dan Mentor.</li>
                        <li><strong>Workshop ‚Üí Session:</strong> Satu workshop dapat memiliki banyak sesi (waktu/mentor
                            berbeda).</li>
                        <li><strong>Session ‚Üí Seat:</strong> Setiap sesi memiliki kursi yang di-generate otomatis
                            berdasarkan quota.</li>
                        <li><strong>Enrollment:</strong> Menghubungkan Student dengan Session dan (opsional) Seat yang
                            dipilih.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 4: ERD -->
        <section id="erd" class="page-break">
            <h2>4. Entity Relationship Diagram (ERD)</h2>

            <div class="diagram-section">
                <h4>üóÑÔ∏è Struktur Database Relasional</h4>
                <div class="mermaid">
                    erDiagram
                    USERS ||--o{ STUDENTS : "is a"
                    USERS ||--o{ MENTORS : "is a"
                    USERS ||--o{ ENROLLMENTS : registers

                    WORKSHOPS ||--o{ WORKSHOP_SESSIONS : "has"
                    WORKSHOP_SESSIONS ||--o{ SCHEDULES : "scheduled"
                    WORKSHOP_SESSIONS ||--o{ SEATS : generates
                    WORKSHOP_SESSIONS ||--o{ ENROLLMENTS : contains

                    MENTORS ||--o{ WORKSHOP_SESSIONS : teaches

                    ENROLLMENTS ||--|| WORKSHOP_ENROLLMENT_SEATS : links
                    SEATS ||--|| WORKSHOP_ENROLLMENT_SEATS : "assigned to"

                    USERS {
                    uuid id PK
                    varchar nim_nidn UK
                    varchar name
                    varchar email UK
                    varchar password_hash
                    enum role
                    enum approval_status
                    timestamp created_at
                    }

                    STUDENTS {
                    uuid id PK
                    uuid user_id FK
                    varchar major
                    int semester
                    int max_credits
                    }

                    MENTORS {
                    uuid id PK
                    uuid user_id FK
                    varchar department
                    int max_concurrent
                    }

                    WORKSHOPS {
                    uuid id PK
                    varchar code UK
                    varchar name
                    int credits
                    enum workshop_type
                    }

                    WORKSHOP_SESSIONS {
                    uuid id PK
                    uuid workshop_id FK
                    uuid mentor_id FK
                    int quota
                    boolean seats_enabled
                    jsonb seat_layout
                    }

                    SEATS {
                    uuid id PK
                    uuid session_id FK
                    varchar seat_number
                    char row_letter
                    int column_number
                    enum status
                    }

                    ENROLLMENTS {
                    uuid id PK
                    uuid student_id FK
                    uuid session_id FK
                    timestamp enrolled_at
                    enum status
                    }
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> ERD menunjukkan hubungan antar tabel dalam PostgreSQL.
                    <ul>
                        <li><strong>USERS:</strong> Tabel utama dengan role (STUDENT/MENTOR) dan status approval.</li>
                        <li><strong>WORKSHOP_SESSIONS:</strong> Instansi workshop dengan quota dan layout kursi (JSON).
                        </li>
                        <li><strong>SEATS:</strong> Kursi dengan status AVAILABLE, RESERVED, atau OCCUPIED.</li>
                        <li><strong>WORKSHOP_ENROLLMENT_SEATS:</strong> Tabel pivot yang menghubungkan enrollment dengan
                            seat.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 5: Component Diagram -->
        <section id="component">
            <h2>5. Component Diagram</h2>

            <div class="diagram-section">
                <h4>üîß Arsitektur Komponen Sistem</h4>
                <div class="mermaid">
                    flowchart TB
                    subgraph Frontend["üñ•Ô∏è Frontend Layer"]
                    FE["React SPA\n(Vite + Tailwind)"]
                    end

                    subgraph Backend["‚öôÔ∏è Backend Services"]
                    API["API Gateway\n(Go + Gin)"]
                    WS["WebSocket Hub\n(Gorilla WS)"]
                    AUTH["Auth Service\n(JWT)"]
                    QUEUE["Queue Service"]
                    SEAT["Seat Service"]
                    end

                    subgraph Messaging["üì® Message Broker"]
                    KAFKA["Apache Kafka\nTopic: queue.join"]
                    end

                    subgraph Cache["‚ö° Cache Layer"]
                    REDIS["Redis 7\n(Locks & Sessions)"]
                    end

                    subgraph Database["üíæ Persistence"]
                    PG["PostgreSQL 15"]
                    end

                    subgraph Observability["üìä Monitoring"]
                    JAEGER["Jaeger\n(Tracing)"]
                    end

                    FE <-->|"HTTP/REST"| API
                        FE <-->|"WebSocket"| WS

                            API --> AUTH
                            API --> QUEUE
                            API --> SEAT

                            QUEUE -->|"Produce"| KAFKA
                            KAFKA -->|"Consume"| QUEUE

                            QUEUE --> REDIS
                            SEAT --> REDIS

                            API --> PG
                            SEAT --> PG

                            API -.->|"Traces"| JAEGER

                            style Frontend fill:#dbeafe,stroke:#2563eb,stroke-width:2px
                            style Backend fill:#dcfce7,stroke:#16a34a,stroke-width:2px
                            style Messaging fill:#fef3c7,stroke:#d97706,stroke-width:2px
                            style Cache fill:#fee2e2,stroke:#dc2626,stroke-width:2px
                            style Database fill:#e0e7ff,stroke:#4f46e5,stroke-width:2px
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Component Diagram menunjukkan arsitektur microservice sistem.
                    <ul>
                        <li><strong>Frontend:</strong> Single Page Application (React) berkomunikasi via REST dan
                            WebSocket.</li>
                        <li><strong>API Gateway:</strong> Entry point untuk semua request, terintegrasi dengan Auth,
                            Queue, dan Seat services.</li>
                        <li><strong>Kafka:</strong> Message broker untuk antrian FIFO yang scalable dan fault-tolerant.
                        </li>
                        <li><strong>Redis:</strong> In-memory store untuk distributed locks dan session management.</li>
                        <li><strong>Jaeger:</strong> Distributed tracing untuk monitoring dan debugging performance.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 6: Sequence Diagram -->
        <section id="sequence" class="page-break">
            <h2>6. Sequence Diagram</h2>

            <div class="diagram-section">
                <h4>üîÑ Alur Reservasi Kursi</h4>
                <div class="mermaid">
                    sequenceDiagram
                    autonumber
                    participant U as üë§ User
                    participant FE as üñ•Ô∏è Frontend
                    participant API as ‚öôÔ∏è Backend API
                    participant R as üî¥ Redis
                    participant DB as üíæ PostgreSQL
                    participant WS as üì° WebSocket Hub
                    participant O as üë• Other Users

                    U->>FE: Klik kursi A1
                    FE->>API: POST /seats/A1/reserve

                    API->>R: SETNX seat_lock:A1 (TTL 10s)

                    alt Lock Berhasil
                    R-->>API: OK (1)
                    API->>R: SET seat_reservation:A1 (TTL 5min)
                    API->>DB: UPDATE seats SET status='RESERVED'
                    API->>WS: Broadcast seat_status_changed
                    WS-->>O: SEAT_RESERVED (A1)
                    API-->>FE: 200 OK {status: RESERVED}
                    FE-->>U: Tampilkan kursi kuning + Timer 5:00
                    else Lock Gagal (Kursi Busy)
                    R-->>API: FAIL (0)
                    API-->>FE: 409 Conflict
                    FE-->>U: Tampilkan "Kursi sedang dipilih"
                    end
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Sequence Diagram menunjukkan urutan interaksi saat reservasi kursi.
                    <ul>
                        <li><strong>Step 1-2:</strong> User mengklik kursi, frontend mengirim request ke API.</li>
                        <li><strong>Step 3:</strong> API mencoba mengambil distributed lock menggunakan Redis SETNX (Set
                            if Not Exists).</li>
                        <li><strong>Step 4-7:</strong> Jika lock berhasil, kursi direservasi dan semua user lain
                            mendapat notifikasi via WebSocket.</li>
                        <li><strong>Alternative:</strong> Jika lock gagal (kursi sudah di-lock user lain), tampilkan
                            error.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 7: State Diagram -->
        <section id="state">
            <h2>7. State Diagram</h2>

            <div class="diagram-section">
                <h4>üîÑ Lifecycle Status Kursi</h4>
                <div class="mermaid">
                    stateDiagram-v2
                    [*] --> AVAILABLE : Session Created

                    AVAILABLE --> LOCKED : User clicks seat\n(Redis SETNX)

                    LOCKED --> AVAILABLE : Lock timeout (10s)\nor Lock failed
                    LOCKED --> RESERVED : Validation OK\nCreate reservation

                    RESERVED --> AVAILABLE : Timer expired (5min)\nor User cancels
                    RESERVED --> OCCUPIED : User confirms\nenrollment

                    OCCUPIED --> [*] : Session ends

                    note right of LOCKED : Transient state\n(max 10 seconds)
                    note right of RESERVED : User has 5 minutes\nto complete enrollment
                    note right of OCCUPIED : Final state\nCannot be changed
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> State Diagram menunjukkan perubahan status kursi selama lifecycle.
                    <ul>
                        <li><strong>AVAILABLE ‚Üí LOCKED:</strong> Saat user mengklik kursi, Redis lock diambil (max 10
                            detik).</li>
                        <li><strong>LOCKED ‚Üí RESERVED:</strong> Setelah validasi berhasil, kursi direservasi dengan TTL
                            5 menit.</li>
                        <li><strong>RESERVED ‚Üí OCCUPIED:</strong> User mengkonfirmasi pendaftaran, kursi menjadi
                            permanen.</li>
                        <li><strong>Rollback:</strong> Jika timeout atau cancel, kursi kembali ke AVAILABLE.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 8: Activity Diagram -->
        <section id="activity" class="page-break">
            <h2>8. Activity Diagram</h2>

            <div class="diagram-section">
                <h4>üìã Alur Pendaftaran Workshop (War)</h4>
                <div class="mermaid">
                    flowchart TD
                    A((üü¢ Start)) --> B[User Login]
                    B --> C[Pilih Workshop]
                    C --> D{Slot Tersedia?}

                    D -->|Ya| E[Langsung ke Selection]
                    D -->|Tidak| F[Join Queue via Kafka]

                    F --> G[Menunggu di Frontend]
                    G --> H{Dapat Notifikasi?}

                    H -->|ACCESS_GRANTED| E
                    H -->|Timeout| I((üî¥ End))

                    E --> J[Lihat Seat Map]
                    J --> K[Klik Kursi]
                    K --> L{Lock Berhasil?}

                    L -->|Ya| M[Timer 5 Menit Mulai]
                    L -->|Tidak| N[Kursi Busy]
                    N --> J

                    M --> O[Konfirmasi Pendaftaran]
                    O --> P{Valid?}

                    P -->|Ya| Q[Simpan ke Database]
                    P -->|Tidak| R[Tampilkan Error]
                    R --> J

                    Q --> S[Enrollment Success!]
                    S --> I

                    style A fill:#22c55e,stroke:#16a34a,stroke-width:2px
                    style I fill:#ef4444,stroke:#dc2626,stroke-width:2px
                    style S fill:#3b82f6,stroke:#2563eb,stroke-width:2px
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Activity Diagram menunjukkan alur aktivitas user saat "War Workshop".
                    <ul>
                        <li><strong>Decision 1 (Slot):</strong> Jika slot penuh, user masuk ke Kafka queue dan menunggu
                            notifikasi WebSocket.</li>
                        <li><strong>Decision 2 (Lock):</strong> Jika kursi sudah dipilih orang lain, user harus pilih
                            kursi lain.</li>
                        <li><strong>Critical Path:</strong> User memiliki waktu terbatas (5 menit) untuk menyelesaikan
                            pendaftaran.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 9: DFD -->
        <section id="dfd">
            <h2>9. Data Flow Diagram (DFD Level 0)</h2>

            <div class="diagram-section">
                <h4>üìä Aliran Data Sistem</h4>
                <div class="mermaid">
                    flowchart LR
                    subgraph External["External Entities"]
                    S["üéì Student"]
                    M["üë®‚Äçüè´ Mentor"]
                    end

                    subgraph Processes["Processes"]
                    P1(("1.0\nAuth"))
                    P2(("2.0\nQueue\nMgmt"))
                    P3(("3.0\nSeat\nReserve"))
                    P4(("4.0\nEnroll"))
                    end

                    subgraph DataStores["Data Stores"]
                    D1[("D1: Users")]
                    D2[("D2: Sessions")]
                    D3[("D3: Seats")]
                    D4[("D4: Enrollments")]
                    end

                    S -->|"Credentials"| P1
                    P1 -->|"Token"| S
                    P1 <-->|"Validate"| D1

                        S -->|"Join Request"| P2
                        P2 -->|"Position"| S
                        P2 <-->|"Check Quota"| D2

                            S -->|"Select Seat"| P3
                            P3 -->|"Status"| S
                            P3 <-->|"Lock/Update"| D3

                                S -->|"Confirm"| P4
                                P4 -->|"Receipt"| S
                                P4 -->|"Create"| D4

                                M -->|"Create/Update"| D2
                                M -->|"Approve"| D1

                                style P1 fill:#dbeafe,stroke:#2563eb
                                style P2 fill:#dcfce7,stroke:#16a34a
                                style P3 fill:#fef3c7,stroke:#d97706
                                style P4 fill:#fce7f3,stroke:#db2777
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> DFD Level 0 menunjukkan aliran data antara entitas eksternal, proses,
                    dan data store.
                    <ul>
                        <li><strong>Process 1.0 (Auth):</strong> Menerima credentials, memvalidasi dengan D1:Users,
                            return token.</li>
                        <li><strong>Process 2.0 (Queue):</strong> Mengelola antrian berdasarkan quota dari D2:Sessions.
                        </li>
                        <li><strong>Process 3.0 (Seat):</strong> Menangani reservasi kursi dengan locking di D3:Seats.
                        </li>
                        <li><strong>Process 4.0 (Enroll):</strong> Finalisasi pendaftaran dan simpan ke D4:Enrollments.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 10: Flowchart -->
        <section id="flowchart" class="page-break">
            <h2>10. System Flowchart</h2>

            <div class="diagram-section">
                <h4>üîÄ Logika Sistem Keseluruhan</h4>
                <div class="mermaid">
                    flowchart TD
                    START((Start)) --> AUTH{User\nAuthenticated?}

                    AUTH -->|No| LOGIN[Show Login Page]
                    LOGIN --> CRED[Enter Credentials]
                    CRED --> VALIDATE{Valid?}
                    VALIDATE -->|No| LOGIN
                    VALIDATE -->|Yes| DASH

                    AUTH -->|Yes| DASH[Dashboard]

                    DASH --> BROWSE[Browse Workshops]
                    BROWSE --> SELECT[Select Workshop]
                    SELECT --> QUEUE{Queue\nFull?}

                    QUEUE -->|Yes| KAFKA[Enter Kafka Queue]
                    KAFKA --> WAIT[Wait for Notification]
                    WAIT --> WS{WebSocket\nMessage?}
                    WS -->|ACCESS_GRANTED| MAP
                    WS -->|Timeout| FAIL[Session Expired]
                    FAIL --> DASH

                    QUEUE -->|No| MAP[Show Seat Map]

                    MAP --> CLICK[Click Seat]
                    CLICK --> LOCK{Lock\nSuccess?}

                    LOCK -->|No| BUSY[Show Busy Error]
                    BUSY --> MAP

                    LOCK -->|Yes| TIMER[Start 5min Timer]
                    TIMER --> CONFIRM[Confirm Enrollment]
                    CONFIRM --> SAVE{Save to\nDatabase?}

                    SAVE -->|Error| ERR[Show Error]
                    ERR --> MAP

                    SAVE -->|Success| SUCCESS[Enrollment Complete!]
                    SUCCESS --> END((End))

                    style START fill:#22c55e,stroke:#16a34a,stroke-width:2px
                    style END fill:#22c55e,stroke:#16a34a,stroke-width:2px
                    style SUCCESS fill:#3b82f6,stroke:#2563eb,stroke-width:2px
                    style FAIL fill:#ef4444,stroke:#dc2626,stroke-width:2px
                </div>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong> Flowchart menunjukkan logika keseluruhan sistem dari awal hingga akhir.
                    <ul>
                        <li><strong>Authentication Flow:</strong> User harus login terlebih dahulu sebelum mengakses
                            fitur.</li>
                        <li><strong>Queue Flow:</strong> Jika slot penuh, user masuk Kafka queue dan menunggu notifikasi
                            WebSocket.</li>
                        <li><strong>Seat Selection Flow:</strong> User harus berhasil mendapatkan lock sebelum bisa
                            reservasi kursi.</li>
                        <li><strong>Error Handling:</strong> Setiap titik kegagalan memiliki fallback yang jelas.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SECTION 11: API Reference -->
        <section id="api">
            <h2>11. Referensi API</h2>

            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Deskripsi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>POST</code></td>
                        <td><code>/api/auth/login</code></td>
                        <td>Autentikasi user, return JWT token</td>
                    </tr>
                    <tr>
                        <td><code>POST</code></td>
                        <td><code>/api/queue/join</code></td>
                        <td>Bergabung ke antrian workshop</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/queue/status</code></td>
                        <td>Cek posisi antrian dan status</td>
                    </tr>
                    <tr>
                        <td><code>POST</code></td>
                        <td><code>/api/workshops/seats/:id/reserve</code></td>
                        <td>Reservasi kursi (distributed lock)</td>
                    </tr>
                    <tr>
                        <td><code>DELETE</code></td>
                        <td><code>/api/workshops/seats/:id/reserve</code></td>
                        <td>Release reservasi kursi</td>
                    </tr>
                    <tr>
                        <td><code>POST</code></td>
                        <td><code>/api/enrollment/add</code></td>
                        <td>Konfirmasi pendaftaran workshop</td>
                    </tr>
                </tbody>
            </table>

            <h3>WebSocket Events</h3>
            <table>
                <thead>
                    <tr>
                        <th>Event Type</th>
                        <th>Direction</th>
                        <th>Payload</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>ACCESS_GRANTED</code></td>
                        <td>Server ‚Üí Client</td>
                        <td>User dipromosikan dari antrian</td>
                    </tr>
                    <tr>
                        <td><code>SEAT_RESERVED</code></td>
                        <td>Server ‚Üí All</td>
                        <td>Kursi direservasi (broadcast)</td>
                    </tr>
                    <tr>
                        <td><code>SEAT_RELEASED</code></td>
                        <td>Server ‚Üí All</td>
                        <td>Kursi dilepas (available kembali)</td>
                    </tr>
                    <tr>
                        <td><code>HEARTBEAT</code></td>
                        <td>Client ‚Üí Server</td>
                        <td>Keep-alive session</td>
                    </tr>
                    <tr>
                        <td><code>HEARTBEAT_ACK</code></td>
                        <td>Server ‚Üí Client</td>
                        <td>Response dengan remaining time</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 12: Kafka & Redis Queue System -->
        <section id="kafka-redis" class="page-break">
            <h2>12. Kafka & Redis Queue System</h2>

            <p>
                Sistem antrian menggunakan kombinasi <strong>Apache Kafka</strong> untuk message ordering (FIFO) dan
                <strong>Redis</strong> untuk state management dan distributed locking. Berikut adalah detail
                implementasinya.
            </p>

            <div class="diagram-section">
                <h4>üì® Kafka Topic: <code>queue.join</code></h4>

                <h4>Producer (API Gateway)</h4>
                <p>Ketika user request bergabung ke antrian, API Gateway mempublish message ke Kafka:</p>

                <pre><code>// Kafka Producer Configuration
kafkaWriter = &kafka.Writer{
    Addr:     kafka.TCP("192.168.0.111:9092"),
    Topic:    "queue.join",
    Balancer: &kafka.LeastBytes{},
}</code></pre>

                <h4>Message Payloads yang di-Produce:</h4>

                <table>
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Kondisi</th>
                            <th>Payload JSON</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>ACTIVATED</code></td>
                            <td>Slot tersedia, user langsung masuk</td>
                            <td>
                                <pre>{
  "userId": "uuid-123",
  "event": "ACTIVATED",
  "timestamp": "2026-02-09T00:50:00Z"
}</pre>
                            </td>
                        </tr>
                        <tr>
                            <td><code>REQUEST_JOIN</code></td>
                            <td>Slot penuh, user masuk antrian</td>
                            <td>
                                <pre>{
  "userId": "uuid-456",
  "event": "REQUEST_JOIN",
  "timestamp": "2026-02-09T00:50:05Z"
}</pre>
                            </td>
                        </tr>
                        <tr>
                            <td><code>PROMOTED</code></td>
                            <td>User dipromosi dari waiting ke active</td>
                            <td>
                                <pre>{
  "userId": "uuid-456",
  "event": "PROMOTED",
  "timestamp": "2026-02-09T00:55:00Z"
}</pre>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="diagram-explanation">
                    <strong>Penjelasan Alur Produce:</strong>
                    <ol>
                        <li>User memanggil <code>POST /api/queue/join</code></li>
                        <li>API cek <code>active_slots</code> (Redis SET) vs <code>queue_limit</code></li>
                        <li>Jika <code>activeCount < limit</code>: Produce <code>ACTIVATED</code>, user langsung masuk
                        </li>
                        <li>Jika <code>activeCount >= limit</code>: Produce <code>REQUEST_JOIN</code>, user menunggu
                        </li>
                    </ol>
                </div>
            </div>

            <div class="diagram-section">
                <h4>üîÑ Kafka Consumer (Background Worker)</h4>

                <pre><code>// Consumer Configuration
kafkaReader = kafka.NewReader(kafka.ReaderConfig{
    Brokers:     []string{"192.168.0.111:9092"},
    Topic:       "queue.join",
    GroupID:     "queue-processor",
    StartOffset: kafka.LastOffset,
})</code></pre>

                <h4>Logika Consumer untuk <code>REQUEST_JOIN</code>:</h4>

                <pre><code>case "REQUEST_JOIN":
    // BLOCKING LOOP - Consumer menunggu hingga slot tersedia
    for {
        // 1. Cek apakah user sudah active (race condition check)
        isActive := redis.SIsMember("active_slots", userId)
        if isActive {
            break // Sudah dipromosi oleh worker lain
        }
        
        // 2. ATOMIC check-and-add menggunakan Lua script
        added := atomicAddToActiveSlotsIfSpace(userId)
        
        if added {
            // 3. Hapus dari waiting queue
            redis.ZRem("waiting_queue", userId)
            
            // 4. Kirim WebSocket notification
            notifyUser(userId, "ACCESS_GRANTED", {
                "message": "Your turn! Redirecting...",
                "status": "ACTIVE"
            })
            break
        }
        
        // 5. Slot masih penuh, tunggu 1 detik
        time.Sleep(1 * time.Second)
    }</code></pre>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong>
                    <ul>
                        <li><strong>Blocking Consumer:</strong> Consumer tidak langsung commit offset. Ia menunggu dalam
                            loop hingga slot tersedia.</li>
                        <li><strong>Atomic Operation:</strong> Menggunakan Lua script di Redis untuk menghindari race
                            condition saat multiple consumer.</li>
                        <li><strong>FIFO Guarantee:</strong> Kafka partition ordering + Redis ZSET score (timestamp)
                            menjamin urutan.</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-section">
                <h4>üî¥ Redis Keys & Data Structures</h4>

                <table>
                    <thead>
                        <tr>
                            <th>Key Pattern</th>
                            <th>Type</th>
                            <th>TTL</th>
                            <th>Deskripsi & Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>active_slots</code></td>
                            <td>SET</td>
                            <td>-</td>
                            <td>User IDs yang sedang aktif di halaman selection<br>
                                <code>SADD active_slots "uuid-123"</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>slot_session:{userId}</code></td>
                            <td>STRING</td>
                            <td>5 min</td>
                            <td>Session marker dengan auto-expire<br>
                                <code>SET slot_session:uuid-123 "active" EX 300</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>waiting_queue</code></td>
                            <td>ZSET</td>
                            <td>-</td>
                            <td>Antrian dengan score = timestamp (FIFO)<br>
                                <code>ZADD waiting_queue 1707436200 "uuid-456"</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>queue_limit</code></td>
                            <td>STRING</td>
                            <td>-</td>
                            <td>Max concurrent users (set by mentor)<br>
                                <code>SET queue_limit 50</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>seat_lock:{seatId}</code></td>
                            <td>STRING</td>
                            <td>10s</td>
                            <td>Distributed lock saat klik kursi<br>
                                <code>SETNX seat_lock:seat-A1 "uuid-123" EX 10</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>seat_reservation:{seatId}</code></td>
                            <td>STRING</td>
                            <td>5 min</td>
                            <td>Reservasi temporary sebelum konfirmasi<br>
                                <code>SET seat_reservation:seat-A1 "uuid-123" EX 300</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>session:{userId}</code></td>
                            <td>HASH</td>
                            <td>2 hour</td>
                            <td>User session data setelah login<br>
                                <code>HSET session:uuid-123 userId "uuid-123" nim "672021001" name "John"</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>active_token:{userId}</code></td>
                            <td>STRING</td>
                            <td>2 hour</td>
                            <td>JWT token aktif (single session enforcement)<br>
                                <code>SET active_token:uuid-123 "eyJhbG..."</code>
                            </td>
                        </tr>
                        <tr>
                            <td><code>promotion_lock</code></td>
                            <td>STRING</td>
                            <td>5s</td>
                            <td>Distributed lock untuk proses promosi<br>
                                <code>SETNX promotion_lock "1" EX 5</code>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h4>Atomic Lua Script untuk Slot Assignment:</h4>
                <pre><code>-- atomicAddToActiveSlotsIfSpace
local activeKey = KEYS[1]      -- "active_slots"
local sessionKey = KEYS[2]     -- "slot_session:{userId}"
local limitKey = KEYS[3]       -- "queue_limit"
local userId = ARGV[1]
local ttl = tonumber(ARGV[2])  -- 300 (5 minutes)

local limit = tonumber(redis.call('GET', limitKey) or '50')
local activeCount = redis.call('SCARD', activeKey)

if activeCount < limit then
    redis.call('SADD', activeKey, userId)
    redis.call('SET', sessionKey, 'active', 'EX', ttl)
    return 1  -- Success
else
    return 0  -- Slots full
end</code></pre>

                <div class="diagram-explanation">
                    <strong>Penjelasan:</strong>
                    <ul>
                        <li><strong>Atomic:</strong> Lua script dieksekusi secara atomic di Redis, mencegah race
                            condition.</li>
                        <li><strong>TTL-based Cleanup:</strong> Session otomatis expire setelah 5 menit tanpa heartbeat.
                        </li>
                        <li><strong>ZSET untuk FIFO:</strong> Score berupa Unix timestamp, sehingga ZRANGE akan return
                            user dalam urutan join.</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-section">
                <h4>üîÅ Complete Queue Flow Diagram</h4>
                <div class="mermaid">
                    sequenceDiagram
                    participant U as User
                    participant API as API Gateway
                    participant K as Kafka
                    participant C as Consumer
                    participant R as Redis
                    participant WS as WebSocket

                    U->>API: POST /queue/join
                    API->>R: SCARD active_slots
                    API->>R: GET queue_limit

                    alt activeCount < limit API->>R: SADD active_slots userId
                        API->>R: SET slot_session:userId (TTL 5m)
                        API->>K: Produce ACTIVATED
                        API-->>U: 200 OK position=0
                        else activeCount >= limit
                        API->>R: ZADD waiting_queue userId
                        API->>K: Produce REQUEST_JOIN
                        API-->>U: 200 OK position=N

                        loop Consumer waits for slot
                        C->>R: atomicAddToActiveSlotsIfSpace
                        alt Slot available
                        R-->>C: 1 (success)
                        C->>R: ZREM waiting_queue userId
                        C->>WS: notify ACCESS_GRANTED
                        WS-->>U: Redirect to selection
                        else Still full
                        R-->>C: 0 (fail)
                        C->>C: Sleep 1s
                        end
                        end
                        end
                </div>
            </div>
        </section>

        <footer>
            <p>Dokumentasi ini dibuat berdasarkan analisis kode sumber sistem Workshop Platform.</p>
            <p><strong>¬© 2026 Universitas Kristen Satya Wacana</strong></p>
            <p>Terakhir diperbarui: 9 Februari 2026</p>
        </footer>
    </div>

    <!-- Mermaid JS for rendering diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#dbeafe',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#3b82f6',
                lineColor: '#475569',
                secondaryColor: '#dcfce7',
                tertiaryColor: '#fef3c7',
                successColor: '#22c55e',
                errorColor: '#ef4444',
                fontFamily: 'Inter, system-ui, sans-serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                boxMargin: 10
            },
            er: {
                useMaxWidth: true
            },
            securityLevel: 'loose'
        });
    </script>
</body>

</html>